
&НаКлиенте
Процедура Выгрузить(Команда)
	АдресФайлаВоВременномХранилище = "";
	
	ВыгрузитьДанныеНаСервере(АдресФайлаВоВременномХранилище);
	
	Если Не ПустаяСтрока(АдресФайлаВоВременномХранилище) Тогда
		ПолучитьФайл(АдресФайлаВоВременномХранилище, Нстр("ru = 'Файл выгрузки.json'"));
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ВыгрузитьДанныеНаСервере(АдресФайлаВоВременномХранилище)
	ИмяВременногоФайла = ПолучитьИмяВременногоФайла("json");
	
	СериализоватьДокумент(ИмяВременногоФайла);

	Файл = Новый Файл(ИмяВременногоФайла);
	Если Файл.Существует() Тогда
		ДвоичныеДанные = Новый ДвоичныеДанные(ИмяВременногоФайла);
		АдресФайлаВоВременномХранилище = ПоместитьВоВременноеХранилище(ДвоичныеДанные, УникальныйИдентификатор);
		УдалитьФайлы(ИмяВременногоФайла);
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция  СериализоватьДокумент(ИмяВременногоФайла)
	Писатель = Новый ЗаписьJSON;
	Писатель.	ОткрытьФайл(ИмяВременногоФайла,,, Новый ПараметрыЗаписиJSON(, Символы.Таб)); 
	
	Значение = СсылкаНаОбъект.ПолучитьОбъект();
	
	СериализаторXDTO.ЗаписатьJSON(Писатель, Значение, НазначениеТипаXML.Явное);
	
	Писатель.Закрыть();
КонецФункции
