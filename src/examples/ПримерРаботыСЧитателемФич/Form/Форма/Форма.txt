
&НаКлиенте
Процедура Команда1(Команда)
	КаталогИнструментов = ПолучитьКаталогИнструментовНаСервере();

	ПолноеИмяФайлаОбработки = КаталогИнструментов + "sbFeatureReader.epf";

	АдресХранилища = "";

	НачатьПомещениеФайла(Новый ОписаниеОповещения("НачатьПомещениеФайлаЗавершение", ЭтотОбъект), АдресХранилища, ПолноеИмяФайлаОбработки, Ложь, Новый УникальныйИдентификатор); 
КонецПроцедуры

&НаСервереБезКонтекста
Функция ПолучитьКаталогИнструментовНаСервере()
	КаталогStackCommons = Константы.КаталогStackCommons.Получить();
	
	Возврат КаталогStackCommons;
КонецФункции

&НаКлиенте
Процедура НачатьПомещениеФайлаЗавершение(Результат, АдресХранилища, ВыбранноеИмяФайла, ДополнительныеПараметры) Экспорт
	Если Результат Тогда
		ИмяВнешнейОбработки = ПодключитьВнешнююОбработкуСервер(АдресХранилища);

		ФормаОбработки = ПолучитьФорму("ВнешняяОбработка." + ИмяВнешнейОбработки + ".Форма.Форма",, ЭтаФорма);
		
		//>>>
		ФормаОбработки.НайтиИПрочитатьФайлыВКаталогах("D:\xDD\Rep\vanessa-stack-commons\lib\Проверка чтения описания и родительских каталогов фич", Истина, "ОписаниеФичиИРодительскихКаталогов");
		//<<<
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ПодключитьВнешнююОбработкуСервер(АдресХранилища)
	Возврат ВнешниеОбработки.Подключить(АдресХранилища,, Ложь);
КонецФункции

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	Если ИмяСобытия = "ОписаниеФичиИРодительскихКаталогов" Тогда
		ОбработатьФичи(Параметр);

	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ОбработатьФичи(Фичи)
	ДеревоНаСервере = РеквизитФормыВЗначение("Дерево");
	
	Для Каждого Строка Из Фичи Цикл
		Фича = Строка.Значение;
		
		ПеренестиРодительскиеКаталогиВДерево(ДеревоНаСервере, Фича.Родитель);
	КонецЦикла;	

	ЗначениеВРеквизитФормы(ДеревоНаСервере, "Дерево");
КонецПроцедуры

&НаСервере
Процедура ПеренестиРодительскиеКаталогиВДерево(Дерево, Родитель)
	Если Родитель = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ИскомаяСтрока = Дерево.Строки.Найти(Родитель.Имя);
	Если ИскомаяСтрока = Неопределено Тогда
		НоваяСтрока = Дерево.Строки.Добавить();
		
		НоваяСтрока.Колонка1 = Родитель.Имя;
		
		ИскомаяСтрока = НоваяСтрока;

	КонецЕсли;
	
	ПеренестиРодительскиеКаталогиВДерево(ИскомаяСтрока, Родитель.Родитель); 
КонецПроцедуры